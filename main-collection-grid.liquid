{% schema %}
{
  "name": "Main Collection Grid",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Featured Products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Shop All Link Text",
      "default": "SHOP ALL"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Shop All Link URL",
      "info": "Leave empty to use the collection URL"
    },
    {
      "type": "range",
      "id": "products_total",
      "min": 4,
      "max": 24,
      "step": 1,
      "default": 12,
      "label": "Total Products to Show"
    },
    {
      "type": "range",
      "id": "products_per_page_desktop",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "Products Visible Per Row (Desktop)"
    },
    {
      "type": "range",
      "id": "products_per_page_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 1,
      "label": "Products Visible Per Row (Mobile)"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        { "value": "full", "label": "Full Width" },
        { "value": "container", "label": "Container (1650px)" },
        { "value": "narrow", "label": "Narrow (1200px)" }
      ],
      "default": "container"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Section Padding Top",
      "default": 40
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Section Padding Bottom",
      "default": 40
    },
    {
      "type": "header",
      "content": "Grid Spacing"
    },
    {
      "type": "range",
      "id": "grid_gap_x",
      "min": 0,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Padding Between Cards (Horizontal)",
      "default": 14
    },
    {
      "type": "range",
      "id": "grid_gap_y",
      "min": 0,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Padding Between Rows (Vertical)",
      "default": 32
    },
    {
      "type": "header",
      "content": "Card Spacing"
    },
    {
      "type": "range",
      "id": "card_options_gap_desktop",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Gap Below Purchase Options (Desktop)",
      "default": 12,
      "info": "Space between One-Time Purchase and variant selector/quantity row"
    },
    {
      "type": "range",
      "id": "card_options_gap_mobile",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Gap Below Purchase Options (Mobile)",
      "default": 12,
      "info": "Space between One-Time Purchase and variant selector/quantity row on mobile"
    },
    {
      "type": "range",
      "id": "card_single_option_height_desktop",
      "min": 40,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Single Option Height (Desktop)",
      "default": 52,
      "info": "Height of purchase options area for apparel/gear with only One-Time Purchase"
    },
    {
      "type": "range",
      "id": "card_single_option_height_mobile",
      "min": 10,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Single Option Height (Mobile)",
      "default": 48,
      "info": "Height of purchase options area for apparel/gear with only One-Time Purchase on mobile"
    },
    {
      "type": "header",
      "content": "Section Margins"
    },
    {
      "type": "range",
      "id": "section_margin_top_desktop",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Margin Top (Desktop)",
      "default": 0
    },
    {
      "type": "range",
      "id": "section_margin_bottom_desktop",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Margin Bottom (Desktop)",
      "default": 0
    },
    {
      "type": "range",
      "id": "section_margin_top_mobile",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Margin Top (Mobile)",
      "default": 0
    },
    {
      "type": "range",
      "id": "section_margin_bottom_mobile",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Margin Bottom (Mobile)",
      "default": 0
    },
    {
      "type": "header",
      "content": "Discount Badge Settings"
    },
    {
      "type": "checkbox",
      "id": "show_discount_badge",
      "label": "Show Discount Badge",
      "default": false,
      "info": "Display discount savings badge on all products"
    },
    {
      "type": "text",
      "id": "discount_percentage",
      "label": "Discount Percentage",
      "default": "20",
      "info": "Just the number (e.g., 20 for 20% off)"
    },
    {
      "type": "text",
      "id": "discount_text",
      "label": "Discount Text",
      "default": "Applied in-cart",
      "info": "Text to display next to the percentage"
    },
    {
      "type": "color",
      "id": "discount_color",
      "label": "Discount Badge Color",
      "default": "#AE1F24"
    },
    {
      "type": "text",
      "id": "apparel_discount_percentage",
      "label": "Apparel/Gear Discount Percentage",
      "default": "20",
      "info": "Separate discount percentage for apparel and gear items (e.g., 20 for 20% off)"
    }
  ],
  "presets": [
    {
      "name": "Main Collection Grid"
    }
  ]
}
{% endschema %}
{% assign collection = collections[section.settings.collection] %}
{% assign products_limit = section.settings.products_total | default: 12 %}
{% assign per_page_desktop = section.settings.products_per_page_desktop | default: 4 %}
{% assign per_page_mobile = section.settings.products_per_page_mobile | default: 1 %}
{% assign section_width = section.settings.section_width | default: 'container' %}
{% assign section_title = section.settings.section_title | default: 'Featured Products' %}
{% assign section_margin_top_desktop = section.settings.section_margin_top_desktop | default: 0 %}
{% assign section_margin_bottom_desktop = section.settings.section_margin_bottom_desktop | default: 0 %}
{% assign section_margin_top_mobile = section.settings.section_margin_top_mobile | default: 0 %}
{% assign section_margin_bottom_mobile = section.settings.section_margin_bottom_mobile | default: 0 %}


{% if collection and collection.products.size > 0 %}
  {% assign first_product_sfp = collection.products.first.metafields.custom.sfp_section.value %}
  {% assign first_product_sfp_item = first_product_sfp | first | default: first_product_sfp %}
  {% assign first_product_series = first_product_sfp_item.series.value %}
  {% assign section_series_color = first_product_series.template_specific_dynamic_featured_color | default: '#AE1F24' %}
{% else %}
  {% assign section_series_color = '#AE1F24' %}
{% endif %}

<section class="featured-grid-section fgc-width-{{ section_width }}" 
         data-section-id="{{ section.id }}"
         style="padding-top: {{ section.settings.section_padding_top }}px; padding-bottom: {{ section.settings.section_padding_bottom }}px; margin-top: {{ section_margin_top_desktop }}px; margin-bottom: {{ section_margin_bottom_desktop }}px; --section-series-color: {{ section_series_color }}; --card-options-gap: {{ section.settings.card_options_gap_desktop | default: 12 }}px; --card-options-gap-mobile: {{ section.settings.card_options_gap_mobile | default: 12 }}px; --card-single-option-height: {{ section.settings.card_single_option_height_desktop | default: 52 }}px; --card-single-option-height-mobile: {{ section.settings.card_single_option_height_mobile | default: 48 }}px; --grid-cols-desktop: {{ per_page_desktop }}; --grid-cols-mobile: {{ per_page_mobile }}; --grid-gap-x: {{ section.settings.grid_gap_x | default: 14 }}px; --grid-gap-y: {{ section.settings.grid_gap_y | default: 32 }}px; --grid-min-col-desktop: 280px; --grid-min-col-tablet: 260px; --grid-min-col-mobile: 200px;">
  {% if collection %}
    <div class="featured-grid-header full-underline">
      <h2 class="featured-grid-title">{{ section_title }}</h2>
      {% if section.settings.link_text != blank %}
        {% assign link_url = section.settings.link_url | default: collection.url %}
        <a href="{{ link_url }}" class="text-with-icon group">
          <span class="fgc-reversed-link">{{- section.settings.link_text | escape -}}</span>
          <span class="circle-chevron group-hover:colors">{%- render 'icon' with 'chevron-right-small', direction_aware: true -%}</span>
        </a>
      {% endif %}
    </div>

    <div class="featured-collection-grid" 
         id="featured-grid-{{ section.id }}"
         data-per-page-desktop="{{ per_page_desktop }}"
         data-per-page-mobile="{{ per_page_mobile }}">
      <ul class="fgc-grid-list">
          {%- comment %}<locksmith:d637>{% endcomment -%}
            {%- assign locksmith_a868_forloop__size = 0 %}{% for product in collection.products limit: products_limit %}{% capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collection, variable: 'transparent' %}{% endcapture %}{% if var == 'true' %}{% assign locksmith_a868_forloop__size = locksmith_a868_forloop__size | plus: 1 %}{% endif %}{% endfor %}{% assign locksmith_a868_forloop__index = nil -%}
          {%- comment %}</locksmith:d637>{% endcomment -%}
          {% for product in collection.products limit: products_limit %}
            {%- comment %}<locksmith:f5db>{% endcomment -%}
              {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collection, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% if locksmith_a868_forloop__index == nil %}{% assign locksmith_a868_forloop__index = 1 %}{% assign locksmith_a868_forloop__index0 = 0 %}{% else %}{% assign locksmith_a868_forloop__index = locksmith_a868_forloop__index | plus: 1 %}{% assign locksmith_a868_forloop__index0 = locksmith_a868_forloop__index0 | plus: 1 %}{% endif %}{% if locksmith_a868_forloop__index == 1 %}{% assign locksmith_a868_forloop__first = true %}{% else %}{% assign locksmith_a868_forloop__first = false %}{% endif %}{% if locksmith_a868_forloop__index == locksmith_a868_forloop__size %}{% assign locksmith_a868_forloop__last = true %}{% else %}{% assign locksmith_a868_forloop__last = false %}{% endif %}{% assign locksmith_a868_forloop__rindex = locksmith_a868_forloop__size | minus: locksmith_a868_forloop__index | minus: 1 %}{% assign locksmith_a868_forloop__rindex0 = locksmith_a868_forloop__size | minus: locksmith_a868_forloop__index0 | minus: 1 %}{% else %}{% continue %}{% endif -%}
            {%- comment %}</locksmith:f5db>{% endcomment -%}
            {% if product.price == 0 or product.price_min == 0 %}
              {% continue %}
            {% endif %}
            {% if product.tags contains 'hide-from-carousel' %}
              {% continue %}
            {% endif %}

            {% assign variant_count = product.variants.size %}
            {% if variant_count <= 1 %}
              {% assign sole_variant = product.variants.first %}
              {% if sole_variant and sole_variant.available == false %}
                {% continue %}
              {% endif %}
            {% endif %}

            {% assign is_apparel_or_gear = false %}
            {% assign product_type_lower = product.type | downcase %}
            {% if product_type_lower contains 'apparel' or product_type_lower contains 'gear' or product_type_lower contains 'clothing' or product.tags contains 'apparel' or product.tags contains 'gear' %}
              {% assign is_apparel_or_gear = true %}
            {% endif %}

            {% assign is_prebuilt_stack = false %}
            {% if product.type == 'Custom Bundle' %}
              {% assign is_prebuilt_stack = true %}
            {% endif %}

            {% assign selected_variant = nil %}
            {% assign non_usa_variant_count = 0 %}

            {% if is_apparel_or_gear %}
              {% assign has_size_option = false %}
              {% assign has_color_option = false %}
              {% assign size_option_index = -1 %}
              {% assign color_option_index = -1 %}

              {% for option in product.options_with_values %}
                {% assign option_name_lower = option.name | downcase %}
                {% if option_name_lower contains 'color' or option_name_lower contains 'colour' %}
                  {% assign has_color_option = true %}
                  {% assign color_option_index = forloop.index0 %}
                {% elsif option_name_lower contains 'size' %}
                  {% assign has_size_option = true %}
                  {% assign size_option_index = forloop.index0 %}
                {% endif %}
              {% endfor %}

              {% assign size_values = '' %}
              {% assign color_values = '' %}
              {% for variant in product.variants %}
                {% if variant.available and selected_variant == nil %}
                  {% assign selected_variant = variant %}
                {% endif %}

                {% if has_size_option %}
                  {% assign size_value = variant.options[size_option_index] %}
                  {% unless size_values contains size_value %}
                    {% if size_values == '' %}
                      {% assign size_values = size_value %}
                    {% else %}
                      {% assign size_values = size_values | append: ',' | append: size_value %}
                    {% endif %}
                  {% endunless %}
                {% endif %}

                {% if has_color_option %}
                  {% assign color_value = variant.options[color_option_index] %}
                  {% unless color_values contains color_value %}
                    {% if color_values == '' %}
                      {% assign color_values = color_value %}
                    {% else %}
                      {% assign color_values = color_values | append: ',' | append: color_value %}
                    {% endif %}
                  {% endunless %}
                {% endif %}
              {% endfor %}
              {% assign size_array = size_values | split: ',' %}
              {% assign color_array = color_values | split: ',' %}

              {% capture swatches_html %}
                {% for variant in product.variants %}
                  <div class="fgc-swatch" style="display: none;"
                       data-variant-id="{{ variant.id }}"
                       data-variant-price="{{ variant.price }}"
                       data-variant-available="{{ variant.available }}"
                       data-product-id="{{ product.id }}"
                       data-variant-name="{{ variant.title }}"
                       {% if variant.featured_image %}data-variant-image="{{ variant.featured_image | image_url: width: 800 }}"{% endif %}></div>
                {% endfor %}
                <div class="fgc-apparel-selector"
                     data-product-id="{{ product.id }}"
                     data-size-index="{{ size_option_index }}"
                     data-color-index="{{ color_option_index }}">
                  {% if has_size_option and size_array.size > 0 %}
                  <div class="fgc-apparel-size-section">
                    <span class="fgc-apparel-label">Size</span>
                    {% if size_array.size > 1 %}
                      <div class="fgc-size-dropdown">
                        <select class="fgc-size-select"
                                data-size-select="{{ product.id }}"
                                onchange="selectGridApparelVariant(this, {{ product.id }}, this.value, null)">
                          {% for size in size_array %}
                            {% assign size_available = false %}
                            {% for variant in product.variants %}
                              {% if variant.options[size_option_index] == size and variant.available %}
                                {% assign size_available = true %}
                                {% break %}
                              {% endif %}
                            {% endfor %}
                            <option value="{{ size }}" {% if selected_variant.options[size_option_index] == size %}selected{% endif %} {% unless size_available %}disabled{% endunless %}>{{ size }}{% unless size_available %} – Out of Stock{% endunless %}</option>
                          {% endfor %}
                        </select>
                      </div>
                    {% else %}
                      <div class="fgc-apparel-static">{{ size_array[0] }}</div>
                    {% endif %}
                  </div>
                  {% endif %}

                  {% if has_color_option and color_array.size > 0 %}
                  <div class="fgc-apparel-color-section">
                    <span class="fgc-apparel-label">Color</span>
                    <div class="fgc-apparel-color-swatches">
                      {% for color in color_array %}
                        {% assign color_available = false %}
                        {% for variant in product.variants %}
                          {% if variant.options[color_option_index] == color and variant.available %}
                            {% assign color_available = true %}
                            {% break %}
                          {% endif %}
                        {% endfor %}
                        {% assign lookup_handle = color | handleize %}
                        {% assign swatch_entry = shop.metaobjects['swatches'][lookup_handle] %}
                        {% assign color_hex = '#333' %}
                        {% assign swatch_image = blank %}
                        {% if swatch_entry %}
                          {% if swatch_entry.color_swatch %}
                            {% assign color_hex = swatch_entry.color_swatch.value | default: '#333' %}
                          {% endif %}
                          {% if swatch_entry.swatch_image %}
                            {% assign swatch_image = swatch_entry.swatch_image.value %}
                          {% endif %}
                        {% endif %}
                        <div class="fgc-color-swatch {% if selected_variant.options[color_option_index] == color %}active{% endif %} {% unless color_available %}disabled{% endunless %}" data-color="{{ color }}" onclick="{% if color_available %}selectGridApparelVariant(this, {{ product.id }}, null, '{{ color | escape }}'){% endif %}">
                          {% if swatch_image != blank %}
                            <span class="fgc-color-circle" style="background-image:url('{{ swatch_image | image_url: width: 40 }}'); background-size: cover; background-position: center;"></span>
                          {% else %}
                            <span class="fgc-color-circle" style="background-color: {{ color_hex }};"></span>
                          {% endif %}
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                  {% endif %}
                </div>
              {% endcapture %}
            {% else %}
              {% capture swatches_html %}
              {% for variant in product.variants %}
                {% assign variant_title_lower = variant.title | downcase %}
                {% assign is_usa_variant = false %}
                {% if variant_title_lower contains '/ usa' or variant_title_lower contains '/usa' or variant.title == 'USA' or variant.title == 'usa' %}
                  {% assign is_usa_variant = true %}
                {% endif %}

                {% unless is_usa_variant %}
                  {% assign non_usa_variant_count = non_usa_variant_count | plus: 1 %}
                  {% if selected_variant == nil and variant.available %}
                    {% assign selected_variant = variant %}
                  {% endif %}

                  {% assign v_sfp_raw = variant.metafields.custom.sfp_section.value %}
                  {% assign v_sfp = v_sfp_raw | first | default: v_sfp_raw %}
                  {% assign swatch_obj = v_sfp.flavor_swatch_image.value %}
                  {% assign swatch_image = swatch_obj.swatch_image.value %}
                  {% assign swatch_color = swatch_obj.color_swatch | default: '#000' %}

                  <div class="fgc-swatch {% if variant == selected_variant %}active{% endif %} {% unless variant.available %}fgc-swatch-unavailable{% endunless %}"
                       data-variant-id="{{ variant.id }}"
                       data-variant-price="{{ variant.price }}"
                       data-variant-available="{{ variant.available }}"
                       data-product-id="{{ product.id }}"
                       data-variant-name="{{ variant.title }}"
                       data-swatch-color="{{ swatch_color }}"
                       style="--swatch-border-color: {{ swatch_color }};"
                       {% if variant.featured_image %}data-variant-image="{{ variant.featured_image | image_url: width: 400 }}"{% endif %}
                       onclick="selectGridVariant(this, {{ product.id }})">
                    {% if swatch_image %}
                      <img src="{{ swatch_image | image_url: width: 40 }}" alt="{{ variant.title }}" loading="lazy">
                    {% else %}
                      <div class="fgc-swatch-placeholder">{{ variant.title | slice: 0 }}</div>
                    {% endif %}
                  </div>
                {% endunless %}
              {% endfor %}
              {% endcapture %}
            {% endif %}

            {% if selected_variant == nil %}
              {% assign selected_variant = product.selected_or_first_available_variant %}
            {% endif %}

            {% comment %} Get the selected variant's swatch color for the CSS variable {% endcomment %}
            {% assign selected_variant_swatch_color = '#000' %}
            {% assign sv_sfp_raw = selected_variant.metafields.custom.sfp_section.value %}
            {% assign sv_sfp = sv_sfp_raw | first | default: sv_sfp_raw %}
            {% assign sv_swatch_obj = sv_sfp.flavor_swatch_image.value %}
            {% if sv_swatch_obj.color_swatch %}
              {% assign selected_variant_swatch_color = sv_swatch_obj.color_swatch %}
            {% endif %}

            {% assign product_sfp_raw = product.metafields.custom.sfp_section.value %}
            {% assign product_sfp = product_sfp_raw | first | default: product_sfp_raw %}
            {% assign product_series = product_sfp.series.value %}
            {% assign series_featured_color = product_series.template_specific_dynamic_featured_color | default: '#AE1F24' %}
            {% assign series_name = product_series.name | default: '' %}
            {% assign series_handle = product_series.handle %}
            {% if series_handle == blank %}
              {% assign series_name_lower = product_series.series_name | downcase | replace: ' ', '-' %}
              {% assign series_handle = series_name_lower %}
            {% endif %}
            {% assign is_core_series = false %}
            {% if series_handle == 'core-series' %}
              {% assign is_core_series = true %}
            {% endif %}

            {% assign variant_display_name = selected_variant.title %}
            {% if variant_display_name == 'Default Title' %}
              {% assign variant_display_name = '' %}
            {% else %}
              {% assign variant_display_name = variant_display_name | remove: '/ USA' | remove: '/ usa' | remove: '/ US' | remove: '/ us' | remove: '/USA' | remove: '/usa' | remove: '/US' | remove: '/us' | remove: ' USA' | remove: ' usa' | remove: ' US' | remove: ' us' | remove: 'USA' | remove: 'usa' | strip %}
            {% endif %}

            {% assign product_info = product.metafields.custom.product_info.value %}
            {% assign product_title = product_info.product_title.value | default: product.title %}
            {% assign product_subheader = product_info.product_sub_header.value | default: '' %}

            {% if is_apparel_or_gear %}
              {% assign current_discount_percent = section.settings.apparel_discount_percentage | default: '20' %}
            {% else %}
              {% assign current_discount_percent = section.settings.discount_percentage | default: '20' %}
            {% endif %}

            <li class="fgc-grid-item">
              <div class="fgc-card{% if is_core_series %} fgc-core-series{% endif %}" 
                   data-product-id="{{ product.id }}"
                   data-product-handle="{{ product.handle }}"
                   data-series="{{ series_name }}"
                   data-is-apparel="{{ is_apparel_or_gear }}"
                   data-product-type="{{ product.type }}"
                   style="--card-series-featured: {{ series_featured_color }}; --active-swatch-color: {{ selected_variant_swatch_color }};">

                <div class="fgc-card__image">
                  <a href="{{ product.url }}">
                    {% if product.featured_image %}
                      <img src="{{ product.featured_image | image_url: width: 800 }}" 
                           alt="{{ product.title }}"
                           loading="lazy"
                           class="fgc-product-image"
                           data-product-image="{{ product.id }}">
                    {% else %}
                      <div class="fgc-placeholder-image">{{ product.title | slice: 0 }}</div>
                    {% endif %}
                  </a>

                  {% if section.settings.show_discount_badge or variant_display_name != blank %}
                  <div class="fgc-image-info" data-image-info="{{ product.id }}">
                    {% if variant_display_name != blank %}
                    <div class="fgc-variant-name" data-variant-name-display="{{ product.id }}">{{ variant_display_name }}</div>
                    {% endif %}
                    {% if section.settings.show_discount_badge %}
                    <div class="fgc-discount-badge" data-discount-badge="{{ product.id }}" style="--discount-badge-color: {{ series_featured_color }};">
                      <span class="fgc-discount-content"><span class="fgc-discount-percent">{{ current_discount_percent }}% OFF</span> {{ section.settings.discount_text }}</span>
                    </div>
                    {% endif %}
                  </div>
                  {% endif %}
                </div>

                <div class="fgc-card__content">
                  <div class="fgc-card__title">
                    <a href="{{ product.url }}">{{ product_title }}</a>
                  </div>

                  <div class="fgc-card__subheader{% if product_subheader == blank %} fgc-card__subheader--empty{% endif %}">{{ product_subheader }}</div>

                  <div class="fgc-card__reviews-price">
                    <div class="fgc-card__reviews">
                      <div class="yotpo bottomLine" 
                           data-product-id="{{ product.id }}"
                           data-url="{{ shop.url }}{{ product.url }}"></div>
                    </div>
                    <div class="fgc-card__price" data-card-price="{{ product.id }}" data-show-discount="{{ section.settings.show_discount_badge }}" data-discount-percent="{{ current_discount_percent }}">
                      {% if section.settings.show_discount_badge %}
                      {% assign discount_amount = selected_variant.price | times: current_discount_percent | divided_by: 100.0 %}
                      {% assign discounted_price = selected_variant.price | minus: discount_amount %}
                      <span class="fgc-price-original">{{ selected_variant.price | money }}</span><span class="fgc-price-display">{{ discounted_price | money }}</span>
                      {% else %}
                      <span class="fgc-price-display">{{ selected_variant.price | money }}</span>
                      {% endif %}
                    </div>
                  </div>

                  {% assign has_selling_plans = false %}
                  {% if product.selling_plan_groups.size > 0 %}
                    {% assign has_selling_plans = true %}
                  {% endif %}

                  <form class="fgc-card__form" data-product-form="{{ product.id }}">
                    {% unless is_prebuilt_stack %}
                      <select name="id" data-variant-select="{{ product.id }}" style="display: none;">
                        {% for variant in product.variants %}
                          <option value="{{ variant.id }}" {% if variant == selected_variant %}selected{% endif %}>{{ variant.title }}</option>
                        {% endfor %}
                      </select>
                      <input type="hidden" value="" data-selling-plan-input="{{ product.id }}">

                      <div class="fgc-purchase-options{% unless has_selling_plans %} fgc-purchase-options--single{% endunless %}" data-purchase-options="{{ product.id }}">
                      <label class="fgc-purchase-option">
                        <input type="radio" name="purchase_type_{{ product.id }}" value="onetime" checked {% unless selected_variant.available %}disabled{% endunless %}>
                        <div class="fgc-option-content">
                          <span class="fgc-option-text">One-Time Purchase</span>
                        </div>
                      </label>

                      {% if has_selling_plans %}
                        {% assign first_plan = product.selling_plan_groups.first.selling_plans.first %}
                        {% assign first_discount = first_plan.price_adjustments[0].value | default: 0 %}

                        <label class="fgc-purchase-option">
                          <input type="radio" 
                                 name="purchase_type_{{ product.id }}" 
                                 value="subscribe"
                                 data-selling-plan-id="{{ first_plan.id }}"
                                 {% unless selected_variant.available %}disabled{% endunless %}>
                          <div class="fgc-option-content">
                            <span class="fgc-option-text">Subscribe & Save {{ first_discount | round }}%</span>
                            <div class="fgc-frequency-selector" data-frequency-selector="{{ product.id }}">
                              <select class="fgc-delivery-frequency" data-frequency-select="{{ product.id }}">
                                {% for selling_plan_group in product.selling_plan_groups %}
                                  {% for selling_plan in selling_plan_group.selling_plans %}
                                    {% assign frequency_parts = selling_plan.name | split: ' - ' | last | split: ' and ' | first | split: 'Delivered ' %}
                                    {% assign frequency_full = frequency_parts[1] | default: frequency_parts[0] %}
                                    {% assign frequency_text = frequency_full | split: '.' | first %}
                                    <option value="{{ selling_plan.id }}" 
                                            data-discount="{{ selling_plan.price_adjustments[0].value }}"
                                            {% if forloop.first %}selected{% endif %}>
                                      {{ frequency_text }}
                                    </option>
                                  {% endfor %}
                                {% endfor %}
                              </select>
                            </div>
                          </div>
                        </label>
                      {% else %}
                        {% unless is_apparel_or_gear %}
                          <label class="fgc-purchase-option fgc-purchase-option--placeholder">
                            <div class="fgc-option-content">
                              <span class="fgc-option-text">&nbsp;</span>
                            </div>
                          </label>
                        {% endunless %}
                      {% endif %}
                    </div>

                    {% endunless %}

                    {% assign show_swatches = false %}
                    {% if is_apparel_or_gear %}
                      {% assign show_swatches = true %}
                    {% elsif non_usa_variant_count > 1 %}
                      {% assign show_swatches = true %}
                    {% elsif non_usa_variant_count == 1 and variant_display_name != blank %}
                      {% assign show_swatches = true %}
                    {% endif %}

                    <div class="fgc-swatches" {% unless show_swatches %}style="visibility: hidden;"{% endunless %}>
                      {{ swatches_html }}
                    </div>

                    {% if is_prebuilt_stack %}
                      <a href="{{ product.url }}" class="fgc-add-to-cart fgc-see-options-btn">
                        <span>See Options</span>
                      </a>
                    {% else %}
                      <div class="fgc-actions" data-actions="{{ product.id }}">
                        <div class="fgc-quantity" data-quantity="{{ product.id }}" {% unless selected_variant.available %}style="display: none;"{% endunless %}>
                          <button type="button" class="fgc-qty-btn" onclick="updateGridQuantity(this, -1)">−</button>
                          <input type="number" name="quantity" value="1" min="1" class="fgc-qty-input">
                          <button type="button" class="fgc-qty-btn" onclick="updateGridQuantity(this, 1)">+</button>
                        </div>

                        <button type="submit" class="fgc-add-to-cart {% unless selected_variant.available %}fgc-out-of-stock{% endunless %}" data-add-btn="{{ product.id }}" {% unless selected_variant.available %}disabled{% endunless %}>
                          {% if selected_variant.available %}<i class="fa-sharp fa-solid fa-cart-circle-plus"></i>{% endif %}
                          <span>{% if selected_variant.available %}Add to Cart{% else %}Out of Stock{% endif %}</span>
                        </button>
                      </div>
                    {% endif %}
                  </form>
                </div>
              </div>
            </li>
          {% endfor %}
      </ul>
    </div>

    <script>
    {%- comment %}<locksmith:31d5>{% endcomment -%}
      {%- assign locksmith_4c12_forloop__size = 0 %}{% for product in collection.products limit: products_limit %}{% capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collection, variable: 'transparent' %}{% endcapture %}{% if var == 'true' %}{% assign locksmith_4c12_forloop__size = locksmith_4c12_forloop__size | plus: 1 %}{% endif %}{% endfor %}{% assign locksmith_4c12_forloop__index = nil -%}
    {%- comment %}</locksmith:31d5>{% endcomment -%}
    {% for product in collection.products limit: products_limit %}
    {%- comment %}<locksmith:dc09>{% endcomment -%}
      {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collection, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% if locksmith_4c12_forloop__index == nil %}{% assign locksmith_4c12_forloop__index = 1 %}{% assign locksmith_4c12_forloop__index0 = 0 %}{% else %}{% assign locksmith_4c12_forloop__index = locksmith_4c12_forloop__index | plus: 1 %}{% assign locksmith_4c12_forloop__index0 = locksmith_4c12_forloop__index0 | plus: 1 %}{% endif %}{% if locksmith_4c12_forloop__index == 1 %}{% assign locksmith_4c12_forloop__first = true %}{% else %}{% assign locksmith_4c12_forloop__first = false %}{% endif %}{% if locksmith_4c12_forloop__index == locksmith_4c12_forloop__size %}{% assign locksmith_4c12_forloop__last = true %}{% else %}{% assign locksmith_4c12_forloop__last = false %}{% endif %}{% assign locksmith_4c12_forloop__rindex = locksmith_4c12_forloop__size | minus: locksmith_4c12_forloop__index | minus: 1 %}{% assign locksmith_4c12_forloop__rindex0 = locksmith_4c12_forloop__size | minus: locksmith_4c12_forloop__index0 | minus: 1 %}{% else %}{% continue %}{% endif -%}
    {%- comment %}</locksmith:dc09>{% endcomment -%}
    window.Product_{{ product.id }} = {
      variants: [
        {% for variant in product.variants %}
        {
          id: {{ variant.id }},
          title: "{{ variant.title | escape }}",
          options: [{% for option in variant.options %}"{{ option | escape }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
          price: {{ variant.price }},
          available: {{ variant.available }},
          featured_image: {% if variant.featured_image %}{ src: "{{ variant.featured_image | image_url: width: 800 }}" }{% else %}null{% endif %}
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    };
    {% endfor %}
    </script>
  {% endif %}
</section>

<style>
.fgc-product-image:hover { transition: ease-in-out 0.3s!important; }
.featured-grid-section { margin: 0 auto; }
.fgc-width-full { max-width: 100%; padding-left: 20px; padding-right: 20px; }
.fgc-width-container { max-width: 1650px; padding-left: 20px; padding-right: 20px; }
.fgc-width-narrow { max-width: 1200px; padding-left: 20px; padding-right: 20px; }
.featured-grid-header { margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
.featured-grid-header.full-underline { position: relative; padding-bottom: 16px; }
.featured-grid-header.full-underline::before { content: ''; position: absolute; bottom: -2px; left: 0; width: 100px; height: 2px; background-color: var(--section-series-color, #AE1F24); }
.featured-grid-title { font-family: 'Gunplay', sans-serif; font-size: 1.75rem; text-transform: uppercase; margin: 0; text-align: left; letter-spacing: 0.5px; }
.featured-grid-section .fgc-grid-list { display: grid; grid-template-columns: repeat(var(--grid-cols-desktop, 4), minmax(0, 1fr)); column-gap: var(--grid-gap-x, 14px); row-gap: var(--grid-gap-y, 32px); list-style: none; padding: 0; margin: 0; align-items: stretch; justify-items: stretch; }
.featured-grid-section .fgc-grid-item { display: flex; width: 100%; min-width: 0; }
@media (max-width: 1200px) {
  .featured-grid-section .fgc-grid-list { grid-template-columns: repeat(auto-fit, minmax(var(--grid-min-col-tablet, 230px), 1fr)); column-gap: calc(var(--grid-gap-x, 14px) * 0.85); row-gap: calc(var(--grid-gap-y, 32px) * 0.9); }
}
@media (max-width: 768px) {
  .featured-grid-section .fgc-grid-list { grid-template-columns: repeat(var(--grid-cols-mobile, 1), minmax(0, 1fr)); column-gap: calc(var(--grid-gap-x, 14px) * 0.7); row-gap: calc(var(--grid-gap-y, 32px) * 0.8); }
}

.featured-grid-section .fgc-grid-list,
.featured-grid-section .fgc-grid-item,
.fgc-card { box-sizing: border-box; }

.fgc-card { background: #fff; border: none; border-radius: 0; padding: 0; display: flex; flex-direction: column; height: 100%; min-height: 100%; width: 100%; min-width: 0; }
.fgc-card__image { width: 100%; position: relative; background: #f9f9f9; padding-bottom: calc(100% + 60px); overflow: hidden; }
@media (max-width: 768px) {
  .fgc-card__image { padding-bottom: calc(100% + 50px); }
  .featured-grid-section { margin-top: {{ section_margin_top_mobile }}px !important; margin-bottom: {{ section_margin_bottom_mobile }}px !important; }
}
.fgc-card__image a { position: absolute; top: 0; left: 0; right: 0; bottom: 60px; display: flex; align-items: center; justify-content: center; z-index: 1; }
@media (max-width: 768px) { .fgc-card__image a { bottom: 50px; } }
.fgc-image-info { display: flex; width: 100%; justify-content: space-between; align-items: flex-start; gap: 8px; padding: 0px 10px 0px 10px; position: absolute; bottom: 0; left: 0; z-index: 2; margin-bottom:0px!important; }
.fgc-variant-name { font-family: 'Acumin Pro Condensed', sans-serif; color: var(--active-swatch-color, #333); display:flex; width: fit-content;justify-content: flex-start; align-items: center; padding: 8px; border-radius:4px;}
.fgc-discount-percent { font-family: 'Acumin Pro Condensed Black', sans-serif; }
.fgc-discount-badge { font-family: 'Acumin Pro Condensed', sans-serif; display: flex; justify-content: flex-end; align-items: flex-start; width: 100px; color: #000; border-radius: 4px; line-height: 1; }
.fgc-discount-content { display: inline-block; font-weight: 700; text-transform: uppercase; text-align: center; }
.fgc-image-info:has(.fgc-variant-name) .fgc-discount-content { max-width: 140px; }
.fgc-image-info:not(:has(.fgc-variant-name)) .fgc-discount-badge { width: 100%; justify-content: center; line-height: unset!important; align-items: center; }
.fgc-image-info:not(:has(.fgc-variant-name)) .fgc-discount-content { white-space: nowrap; padding: 8px; display: flex; align-items: center; justify-content: center;gap:3px; }
.fgc-product-image { width: 100%; height: 100%; object-fit: contain; transition: opacity 0.3s ease-in-out; }
.fgc-product-image:hover { opacity: 0.7; }
.fgc-placeholder-image { font-size: 16px; font-weight: bold; color: #999; }
.fgc-card__content { border: 2px solid #f9f9f9; display: flex; flex-direction: column; flex: 1; }
.fgc-card__title { font-family: 'Gunplay', sans-serif; font-size: 1.4rem; line-height: 1.3; min-height: 50px; height: 50px; display: block; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; padding: 12px 12px 0; text-transform: uppercase; }
.fgc-card__title a { color: #000; text-decoration: none; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fgc-card__subheader { font-family: 'Acumin Pro', sans-serif; font-size: 16px; color: #000; line-height: 1.4; display: flex; align-items: flex-start; padding: 0 12px; min-height: 22px; height: 22px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.fgc-card__subheader--empty { visibility: hidden; }
.fgc-card__reviews-price { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; gap: 12px; min-height: 32px; height: 32px; padding: 0 12px; }
.fgc-card[data-product-type="Custom Bundle"] .fgc-card__reviews-price { margin-bottom: 0; }
.fgc-card[data-product-type="Custom Bundle"] .fgc-card__form { padding-top: 8px; }
.fgc-card[data-product-type="Custom Bundle"] .fgc-card__subheader { display: none; }
.fgc-card[data-product-type="Custom Bundle"] .fgc-swatches { display: none; }
.fgc-card__reviews { flex: 0 0 auto; }
.fgc-card__reviews .yotpo .text-m, .fgc-card__reviews .yotpo .yotpo-bottomline-box-1, .fgc-card__reviews .yotpo .yotpo-bottomline .text-m, .fgc-card__reviews .yotpo .standalone-bottomline .text-m { display: none !important; }
.fgc-card__reviews .yotpo-sr-bottom-line-right-panel, .fgc-card__reviews .yotpo-sr-vertical-border { display: none !important; }
.fgc-card .yotpo-sr-star-full path, .fgc-card .yotpo-icon-star, .fgc-card svg.star-container path { fill: var(--card-series-featured, #AE1F24) !important; stroke: var(--card-series-featured, #AE1F24) !important; }
.fgc-card .yotpo-sr-bottom-line-left-panel.yotpo-sr-bottom-line-score, .fgc-card .yotpo-sr-bottom-line-score { color: var(--card-series-featured, #AE1F24) !important; }
.fgc-card__price { display: flex; justify-content: flex-end; align-items: baseline; gap: 8px; flex-shrink: 0; }
.fgc-price-display { font-family: 'Acumin Pro', sans-serif; font-size: 16px; font-weight: 400; color: black; }
.fgc-price-original { text-decoration: line-through; color: #999; font-size: 16px; font-weight: 400; }
.fgc-price-subscribe { color: black; font-size: 16px; font-weight: 400; }
.fgc-card__form { display: flex; flex-direction: column; gap: 12px; padding: 0 12px 12px; }
.fgc-purchase-options { display: flex; flex-direction: column; gap: 8px; margin-bottom: 0; align-items: stretch; min-height: 104px; }
.fgc-purchase-options--single { min-height: var(--card-single-option-height, 52px); }
.fgc-purchase-option { cursor: pointer; display: block; width: 100%; }
.fgc-purchase-option input[type="radio"] { display: none; }
.fgc-option-content { border: 2px solid #e0e0e0; border-radius: 4px; padding: 12px 16px; background: #fff; position: relative; display: flex; align-items: center; min-height: 48px; gap: 8px; }
.fgc-option-content::before { content: ''; width: 16px; height: 16px; border: 2px solid #ccc; border-radius: 50%; flex-shrink: 0; }
.fgc-purchase-option input[type="radio"]:checked + .fgc-option-content { border-color: #ccc; background: #f9f9f9; padding-right: 110px; }
.fgc-purchase-option input[type="radio"]:checked + .fgc-option-content::before { border-color: #666; background: #666; box-shadow: inset 0 0 0 3px #fff; }
.fgc-purchase-option input[type="radio"]:disabled + .fgc-option-content { opacity: 0.5; cursor: not-allowed; }
.fgc-purchase-option input[type="radio"]:disabled:checked + .fgc-option-content { border-color: #ccc; background: #f5f5f5; }
.fgc-purchase-option input[type="radio"]:disabled:checked + .fgc-option-content::before { border-color: #ccc; background: #ccc; }
.fgc-purchase-option--placeholder .fgc-option-content { visibility: hidden; }
.fgc-option-content { min-width: 0; }
.fgc-purchase-option { min-width: 0; }
.fgc-option-text { font-family: 'Acumin Pro', sans-serif; font-size: 14px; font-weight: 600; color: #000; flex: 1; text-align: left; white-space: nowrap; line-height: 1.2; word-break: normal; overflow: hidden; text-overflow: ellipsis; }
.fgc-frequency-selector { display: none; margin-left: auto; flex-shrink: 0; width: auto; max-width: 110px; position: absolute; right: 16px; }
.fgc-purchase-option input[type="radio"]:checked + .fgc-option-content .fgc-frequency-selector { display: block; }
.fgc-delivery-frequency { width: 100%; padding: 6px 24px 6px 8px; border: 1px solid #e0e0e0; border-radius: 4px; font-family: 'Acumin Pro', sans-serif; font-size: 12px; background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") no-repeat; background-position: right 6px center; background-size: 10px; cursor: pointer; -webkit-appearance: none; -moz-appearance: none; appearance: none; text-transform: capitalize; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fgc-delivery-frequency option { white-space: normal; }
.fgc-swatches { display: flex; flex-wrap: wrap; gap: 6px; margin-top: var(--card-options-gap, 12px); min-height: 44px; align-items:center; overflow: visible; width: 100%; box-sizing: border-box; }
.fgc-swatch { flex: 0 0 32px; width: 32px; height: 32px; border: 2px solid #e0e0e0; border-radius: 4px; cursor: pointer; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #fff; padding: 5px; }
.fgc-swatch img { width: 100%; height: 100%; object-fit: contain; }
.fgc-swatch:hover:not(.fgc-swatch-unavailable), .fgc-swatch.active { border: 2px solid var(--swatch-border-color, #000); padding: 5px; }
.fgc-card:has(.fgc-out-of-stock) .fgc-swatch.active { border-color: #ccc; }
.fgc-swatch.fgc-swatch-unavailable { opacity: 1; cursor: not-allowed; }
.fgc-swatch.fgc-swatch-unavailable img { filter: grayscale(100%); opacity: 0.5; }
.fgc-swatch-placeholder { font-size: 16px; font-weight: bold; color: #999; }

.fgc-apparel-selector { display: flex; flex-direction: row; width:100%; align-items: center; gap: 12px; min-height: 44px; flex-wrap: nowrap; overflow: visible; }
.fgc-apparel-size-section { display: flex; flex-direction: row; gap: 6px; align-items: center; flex: 1 1 auto; min-width: 150px; }
.fgc-apparel-color-section { display: flex; flex-direction: row; gap: 6px; align-items: center; flex: 0 0 auto; margin-left: auto; }
.fgc-size-dropdown, .fgc-size-select { width: 100%; }
.fgc-apparel-label { display: none; }
.fgc-size-dropdown { width: 100%; }
.fgc-size-select { width: 100%; padding: 8px 32px 8px 12px; border: 2px solid #e0e0e0; border-radius: 4px; font-family: 'Acumin Pro', sans-serif; font-size: 14px; font-weight: 600; background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E") no-repeat; background-position: right 10px center; background-size: 12px; cursor: pointer; -webkit-appearance: none; -moz-appearance: none; appearance: none; }
.fgc-size-select {
  height: 36px;
  padding-top: 0;
  padding-bottom: 0;
  display: flex;
  align-items: center;
}

@media (max-width: 768px) {
  .fgc-size-select {
    height: 40px;
  }
}
.fgc-size-select:disabled { opacity: 0.5; cursor: not-allowed; }
.fgc-size-select option:disabled { color: #999; }
.fgc-apparel-static { font-family: 'Acumin Pro', sans-serif; font-size: 14px; font-weight: 600; padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 4px; background: #f9f9f9; }
.fgc-apparel-color-swatches { display: flex; flex-wrap: nowrap; gap: 8px; justify-content: flex-end; margin-left: auto; }
.fgc-color-swatch { width: 36px; height: 36px; border: 2px solid #e0e0e0; border-radius: 4px; cursor: pointer; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #fff; padding: 1px; transition: border-color 0.2s ease; }
.fgc-color-swatch.active { border-color: #000; border-width: 2px; padding: 1px; }
.fgc-color-swatch.disabled { opacity: 0.5; cursor: not-allowed; }
.fgc-color-swatch:not(.disabled):hover { border-color: #666; }
.fgc-color-circle { width: 100%; height: 100%; border-radius: 4px; display: block; }

.fgc-actions { display: flex; gap: 6px; align-items: stretch; }
.fgc-quantity { display: flex; border: 2px solid #e0e0e0; border-radius: 4px; overflow: hidden; width: 78px; flex-shrink: 0; }
.fgc-qty-btn { width: 26px; border: none; background: #fff; font-size: 17px; cursor: pointer; color: #000; display: flex; align-items: center; justify-content: center; padding: 0; }
.fgc-qty-input { width: 30px; border: none; text-align: center; font-size: 15px; font-weight: 600; -moz-appearance: textfield; padding: 0; }
.fgc-qty-input::-webkit-outer-spin-button, .fgc-qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.fgc-add-to-cart { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; background: var(--card-series-featured, #AE1F24); color: white; border: none; padding: 11px 14px; border-radius: 4px; font-family: 'Gunplay', sans-serif; font-size: 15px; text-transform: uppercase; cursor: pointer; letter-spacing: 0.5px; position: relative; overflow: hidden; z-index: 1; white-space: nowrap; }
.fgc-add-to-cart i, .fgc-add-to-cart svg { font-size: 18px; position: relative; z-index: 2; transition: color 0.3s ease; color: white; }
.fgc-add-to-cart span { position: relative; z-index: 2; }
.fgc-add-to-cart::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: #000; transition: left 0.4s ease; z-index: -1; }
.fgc-add-to-cart:hover { color: #fff; }
.fgc-add-to-cart:hover::before { left: 0; }
.fgc-add-to-cart:not(:hover)::before { left: -100%; transition: left 0.4s ease; }
.fgc-add-to-cart.fgc-out-of-stock, .fgc-add-to-cart:disabled { background: #999; opacity: 0.6; cursor: not-allowed; color: white; }
.fgc-add-to-cart.fgc-out-of-stock i, .fgc-add-to-cart:disabled i { display: none !important; }
.fgc-add-to-cart.fgc-out-of-stock::before, .fgc-add-to-cart.fgc-out-of-stock::after, .fgc-add-to-cart:disabled::before, .fgc-add-to-cart:disabled::after { display: none; }
.fgc-add-to-cart.fgc-out-of-stock:hover, .fgc-add-to-cart:disabled:hover { background: #999; color: white; }
.fgc-add-to-cart.adding { background: color-mix(in srgb, var(--card-series-featured, #AE1F24) 60%, white); transition: background 0.3s ease; }
.fgc-add-to-cart::after { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: #35bf86; z-index: 0; transition: none; }
.fgc-add-to-cart.success::before { display: none; }
.fgc-add-to-cart.adding.success { color: var(--card-series-featured, #AE1F24); }
.fgc-add-to-cart.adding.success::after { z-index: 1; animation: fccFillSuccess 0.6s ease forwards; }
@keyframes fccFillSuccess { 0% { left: -100%; } 100% { left: 0; } }
.fgc-see-options-btn { text-decoration: none; display: flex; align-items: center; justify-content: center; }
.fgc-see-options-btn:hover { text-decoration: none; }

.featured-grid-section .fgc-core-series .fgc-add-to-cart { color: #000 !important; border: none !important; }
.featured-grid-section .fgc-core-series .fgc-add-to-cart i, .featured-grid-section .fgc-core-series .fgc-add-to-cart svg { color: #000 !important; }
.featured-grid-section .fgc-core-series .fgc-add-to-cart:hover { color: var(--card-series-featured, #AE1F24) !important; }
.featured-grid-section .fgc-core-series .fgc-add-to-cart:hover i, .featured-grid-section .fgc-core-series .fgc-add-to-cart:hover svg { color: var(--card-series-featured, #AE1F24) !important; }

.fgc-reversed-link { font-family: "gunplay", sans-serif; font-weight: 400; font-style: normal; letter-spacing: 0px; text-transform: uppercase; }
.featured-collection-grid { position: relative; }
.fc-shop-all-btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #f5f5f5; border-radius: 50px; text-decoration: none; color: #000; font-family: 'Gunplay', sans-serif; font-size: 14px; font-weight: 700; letter-spacing: 0.5px; transition: background 0.3s ease; }
.fc-shop-all-btn:hover { background: #e0e0e0; }
.fc-shop-all-btn svg { transition: transform 0.3s ease; }
.fc-shop-all-btn:hover svg { transform: translateX(3px); }

@media (max-width: 1024px) {
  .fgc-swatches { gap: 4px; }
  .fgc-swatch { flex: 0 0 30px; width: 30px; height: 30px; }
  .fgc-actions { gap: 6px; }
  .fgc-quantity { width: 64px; }
  .fgc-qty-btn { width: 24px; font-size: 15px; }
  .fgc-qty-input { width: 28px; font-size: 14px; }
  .fgc-add-to-cart { padding: 10px 12px; font-size: 14px; }
  .fgc-option-text { white-space: nowrap; font-size: 13.5px; }
}

@media (max-width: 768px) {
  .featured-grid-header { flex-direction: column; align-items: flex-start; }
  .featured-grid-header .text-with-icon { width: 100%; }
  .featured-grid-title { font-size: 24px; }
  .fgc-card__title { font-size: 1.5rem; }
  .fgc-card__subheader { font-size: 14px; }
  .fgc-swatches:has(.fgc-apparel-selector.fgc-single-row) { min-height: 50px; }
  .fgc-swatches { gap: 10px; flex-wrap: wrap; min-height: 92px; height: auto; margin-top: var(--card-options-gap-mobile, 12px); overflow: visible; }
  .fgc-swatches.fgc-single-row { align-items: flex-end; }
  .fgc-swatch { flex: 0 0 30px; width: 30px; height: 30px; padding: 4px; }
  .fgc-swatch:hover:not(.fgc-swatch-unavailable), .fgc-swatch.active { border: 2px solid var(--swatch-border-color, #000); padding: 5px; }
  .fgc-apparel-selector { flex-wrap: wrap; min-height: 50px; height: auto; align-items: flex-start; width:100%; }
  .fgc-purchase-options--single { min-height: var(--card-single-option-height-mobile, 48px); }
  .fgc-apparel-selector.fgc-single-row { align-items: flex-end; align-content: flex-end; }
  .fgc-apparel-selector.fgc-single-row .fgc-apparel-size-section,
  .fgc-apparel-selector.fgc-single-row .fgc-apparel-color-section { align-self: flex-end; }
  .fgc-apparel-selector.fgc-single-row .fgc-apparel-color-swatches { align-items: flex-end; }
  .fgc-apparel-size-section { flex: 1 1 auto; min-width: 150px; }
  .fgc-apparel-color-section { margin-left: auto; align-self: flex-start; }
  .fgc-apparel-color-swatches { justify-content: flex-end; flex-wrap: wrap; margin-left: auto; }
  .fgc-color-swatch { width: 40px; height: 40px; }
  .fgc-product-image { max-width: 85%; max-height: 85%; width: auto; height: auto; }
  .fgc-quantity { width: 58px; }
  .fgc-qty-btn { width: 22px; font-size: 15px; }
  .fgc-qty-input { width: 24px; font-size: 13px; }
  .fgc-add-to-cart i { font-size: 16px; gap: 8px; }
  .fgc-add-to-cart { padding: 10px 10px; font-size: 14px; }
  .fgc-option-content { padding: 10px 12px; min-height: 42px; }
  .fgc-purchase-option input[type="radio"]:checked + .fgc-option-content { padding-right: 90px; }
  .fgc-option-text { font-size: 13px; white-space: normal; }
  .fgc-frequency-selector { max-width: 105px; right: 12px; }
  .fgc-delivery-frequency { font-size: 14px; padding: 4px 20px 4px 6px; }
  .fgc-variant-name { font-size: 1rem; padding: 6px; }
  .fgc-discount-content { font-size: 1rem; max-width: 100px; }
  .fgc-image-info:not(:has(.fgc-variant-name)) { align-items: center; }
  .fgc-image-info:not(:has(.fgc-variant-name)) .fgc-discount-badge { width: 100%; justify-content: center; align-items: center; }
  .fgc-image-info:not(:has(.fgc-variant-name)) .fgc-discount-content { width: 100%; text-align: center; align-items: center; justify-content: center; }
  .fgc-image-info{ margin-bottom:12px!important;}
}

@media (min-width: 768px) {
  .featured-grid-title{font-size:2rem;}
  .featured-grid-header{margin-bottom: 55px;}
}
</style>

<script>
function selectGridVariant(el, pid) {
  if (!el || el.classList.contains('fgc-swatch-unavailable')) return;
  const card = el.closest('.fgc-card');
  if (!card) return;
  const vid = el.getAttribute('data-variant-id');
  const vp = el.getAttribute('data-variant-price');
  const vi = el.getAttribute('data-variant-image');
  const va = el.getAttribute('data-variant-available') === 'true';
  const vname = el.getAttribute('data-variant-name');
  const swatchColor = el.getAttribute('data-swatch-color');
  card.querySelectorAll('.fgc-swatch').forEach(function(s) { s.classList.remove('active'); });
  el.classList.add('active');
  if (swatchColor) card.style.setProperty('--active-swatch-color', swatchColor);
  const inp = card.querySelector('[data-variant-input="' + pid + '"]');
  if (inp) inp.value = vid;
  const variantSelect = card.querySelector('[data-variant-select="' + pid + '"]');
  if (variantSelect) {
    for (let i = 0; i < variantSelect.options.length; i++) {
      if (variantSelect.options[i].value === vid) { variantSelect.selectedIndex = i; break; }
    }
  }
  if (vi) {
    const img = card.querySelector('[data-product-image="' + pid + '"]');
    if (img) { img.src = vi; img.srcset = ''; }
  }
  const vnd = card.querySelector('[data-variant-name-display="' + pid + '"]');
  if (vnd && vname) {
    let cleanedName = vname;
    if (cleanedName === 'Default Title') cleanedName = '';
    else cleanedName = cleanedName.replace(/\/ USA|\/ usa|\/ US|\/ us|\/USA|\/usa|\/US|\/us| USA| usa| US| us|USA$|usa$/g, '').trim();
    if (cleanedName) { vnd.textContent = cleanedName; vnd.style.display = 'flex'; }
    else vnd.style.display = 'none';
  }
  updateGridPrice(card, pid, vp);
  const btn = card.querySelector('[data-add-btn="' + pid + '"]');
  if (btn) {
    btn.disabled = !va;
    if (va) { btn.classList.remove('fgc-out-of-stock'); btn.querySelector('span').textContent = 'Add to Cart'; }
    else { btn.classList.add('fgc-out-of-stock'); btn.querySelector('span').textContent = 'Out of Stock'; }
  }
  const qty = card.querySelector('[data-quantity="' + pid + '"]');
  if (qty) qty.style.display = va ? 'flex' : 'none';
  const purchaseOpts = card.querySelector('[data-purchase-options="' + pid + '"]');
  if (purchaseOpts) purchaseOpts.querySelectorAll('input[type="radio"]').forEach(function(r) { r.disabled = !va; });
  updateImageInfoDisplay(card, pid);
  applyGridApparelSingleRowAlignment();
}

function updateGridPrice(card, pid, bp) {
  const pc = card.querySelector('[data-card-price="' + pid + '"]');
  if (!pc) return;
  const sr = card.querySelector('input[value="subscribe"]:checked');
  const fs = card.querySelector('[data-frequency-select="' + pid + '"]');
  const showDiscount = pc.getAttribute('data-show-discount') === 'true';
  const discountPercent = parseFloat(pc.getAttribute('data-discount-percent')) || 0;
  let h = '';
  if (sr && fs) {
    const opt = fs.options[fs.selectedIndex];
    const d = parseFloat(opt.getAttribute('data-discount')) || 0;
    const dp = bp * (1 - d / 100);
    h = '<span class="fgc-price-original">' + formatMoney(bp) + '</span><span class="fgc-price-subscribe">' + formatMoney(dp) + '</span>';
  } else if (showDiscount && discountPercent > 0) {
    const discountedPrice = bp * (1 - discountPercent / 100);
    h = '<span class="fgc-price-original">' + formatMoney(bp) + '</span><span class="fgc-price-display">' + formatMoney(discountedPrice) + '</span>';
  } else {
    h = '<span class="fgc-price-display">' + formatMoney(bp) + '</span>';
  }
  pc.innerHTML = h;
}

function formatMoney(c) { return '$' + (c / 100).toFixed(2); }

function updateGridQuantity(btn, ch) {
  const inp = btn.parentElement.querySelector('.fgc-qty-input');
  let v = parseInt(inp.value) || 1;
  v += ch;
  if (v < 1) v = 1;
  inp.value = v;
}

function updateImageInfoDisplay(card, pid) {
  const imgInfo = card.querySelector('[data-image-info="' + pid + '"]');
  if (!imgInfo) return;
  const vnd = card.querySelector('[data-variant-name-display="' + pid + '"]');
  const badge = card.querySelector('[data-discount-badge="' + pid + '"]');
  const hasVariantName = vnd && vnd.textContent && vnd.textContent.trim() !== '';
  const hasBadge = badge && badge.style.display !== 'none';
  if (!hasVariantName && !hasBadge) { imgInfo.style.display = 'none'; imgInfo.style.marginBottom = '0'; }
  else { imgInfo.style.display = 'flex'; imgInfo.style.marginBottom = '12px'; }
}

function selectGridApparelVariant(triggerEl, pid, newSize, newColor) {
  const card = triggerEl.closest('.fgc-card');
  if (!card) return;
  const variantSelect = card.querySelector('[data-variant-select="' + pid + '"]');
  if (!variantSelect) return;
  const apparelSelector = card.querySelector('.fgc-apparel-selector[data-product-id="' + pid + '"]');
  if (!apparelSelector) return;
  const sizeIndex = parseInt(apparelSelector.getAttribute('data-size-index'), 10);
  const colorIndex = parseInt(apparelSelector.getAttribute('data-color-index'), 10);
  const productObj = window['Product_' + pid];
  if (!productObj || !productObj.variants) return;
  const currentVariantId = variantSelect.value;
  const currentVariant = productObj.variants.find(function(v) { return String(v.id) === String(currentVariantId); });
  const currentOptions = currentVariant ? currentVariant.options : [];
  let targetSize = newSize != null ? newSize : (sizeIndex >= 0 ? currentOptions[sizeIndex] : null);
  let targetColor = newColor != null ? newColor : (colorIndex >= 0 ? currentOptions[colorIndex] : null);
  let matchVariant = null;
  productObj.variants.forEach(function(v) {
    const opts = v.options || [];
    const vSize = sizeIndex >= 0 ? opts[sizeIndex] : null;
    const vColor = colorIndex >= 0 ? opts[colorIndex] : null;
    if (vSize === targetSize && vColor === targetColor) matchVariant = v;
  });
  if (!matchVariant) return;
  const vid = String(matchVariant.id);
  for (let i = 0; i < variantSelect.options.length; i++) {
    if (String(variantSelect.options[i].value) === vid) { variantSelect.selectedIndex = i; break; }
  }
  const hiddenSwatch = card.querySelector('.fgc-swatch[data-variant-id="' + vid + '"]');
  if (hiddenSwatch) selectGridVariant(hiddenSwatch, pid);
  else {
    updateGridPrice(card, pid, matchVariant.price);
    const vnd = card.querySelector('[data-variant-name-display="' + pid + '"]');
    if (vnd) vnd.textContent = matchVariant.title || '';
  }
  if (newColor != null) {
    card.querySelectorAll('.fgc-color-swatch').forEach(function(sw) {
      sw.classList.toggle('active', sw.getAttribute('data-color') === newColor);
    });
  }
  if (newSize != null) {
    const sizeSelect = card.querySelector('.fgc-size-select[data-size-select="' + pid + '"]');
    if (sizeSelect) sizeSelect.value = newSize;
  }
  applyGridApparelSingleRowAlignment();
}

function applyGridApparelSingleRowAlignment() {
  if (window.innerWidth > 768) return;
  document.querySelectorAll('.fgc-apparel-selector').forEach(function(sel) {
    sel.classList.remove('fgc-single-row');
    const swWrap = sel.querySelector('.fgc-apparel-color-swatches');
    if (!swWrap) return;
    const swatches = Array.prototype.slice.call(swWrap.querySelectorAll('.fgc-color-swatch'));
    if (swatches.length === 0) return;
    const firstTop = swatches[0].offsetTop;
    let wrapped = false;
    for (let i = 1; i < swatches.length; i++) {
      if (swatches[i].offsetTop > firstTop) { wrapped = true; break; }
    }
    if (!wrapped) sel.classList.add('fgc-single-row');
  });
  document.querySelectorAll('.fgc-swatches').forEach(function(cont) {
    if (cont.querySelector('.fgc-apparel-selector')) return;
    cont.classList.remove('fgc-single-row');
    const swatches = Array.prototype.slice.call(cont.querySelectorAll('.fgc-swatch:not([style*="display: none"])'));
    if (swatches.length === 0) return;
    const firstTop = swatches[0].offsetTop;
    let wrapped = false;
    for (let i = 1; i < swatches.length; i++) {
      if (swatches[i].offsetTop > firstTop) { wrapped = true; break; }
    }
    if (!wrapped) cont.classList.add('fgc-single-row');
  });
}

document.addEventListener('DOMContentLoaded', function() {

  document.querySelectorAll('.fgc-purchase-option input[type="radio"]').forEach(function(r) {
    r.addEventListener('change', function() {
      try {
        const pid = this.name.replace('purchase_type_', '');
        const card = this.closest('.fgc-card');
        if (!card) return;
        const fselt = card.querySelector('[data-frequency-select="' + pid + '"]');
        const spin = card.querySelector('[data-selling-plan-input="' + pid + '"]');
        if (this.value === 'subscribe') {
          if (fselt && spin) spin.value = fselt.value;
        } else {
          if (spin) spin.value = '';
        }
        const av = card.querySelector('.fgc-swatch.active');
        if (av) {
          const vp = av.getAttribute('data-variant-price');
          updateGridPrice(card, pid, vp);
        }
      } catch (e) {}
    });
  });

  document.querySelectorAll('.fgc-delivery-frequency').forEach(function(sel) {
    sel.addEventListener('change', function() {
      try {
        const pid = this.getAttribute('data-frequency-select');
        const card = this.closest('.fgc-card');
        if (!card) return;
        const spin = card.querySelector('[data-selling-plan-input="' + pid + '"]');
        if (spin) spin.value = this.value;
        const av = card.querySelector('.fgc-swatch.active');
        if (av) {
          const vp = av.getAttribute('data-variant-price');
          updateGridPrice(card, pid, vp);
        }
      } catch (e) {}
    });
  });

  document.querySelectorAll('[data-product-form]').forEach(function(frm) {
    frm.addEventListener('submit', function(e) {
      e.preventDefault();
      try {
        const pid = this.getAttribute('data-product-form');
        const btn = this.querySelector('[data-add-btn="' + pid + '"]');
        if (!btn || btn.disabled) return;
        const txt = btn.querySelector('span');
        if (!txt) return;
        const ot = txt.textContent;
        btn.disabled = true;
        btn.classList.add('adding');
        txt.textContent = 'Adding...';

        const variantSelect = this.querySelector('[data-variant-select="' + pid + '"]');
        const selectedVariantId = variantSelect ? variantSelect.value : null;

        const fd = new FormData();
        fd.append('id', selectedVariantId);

        const qtyInput = this.querySelector('.fgc-qty-input');
        if (qtyInput) fd.append('quantity', qtyInput.value);

        const sr = this.querySelector('input[value="subscribe"]:checked');
        const spin = this.querySelector('[data-selling-plan-input="' + pid + '"]');
        if (sr && spin && spin.value) fd.append('selling_plan', spin.value);

        fetch('/cart/add.js', { method: 'POST', body: fd, headers: { 'Accept': 'application/json' } })
          .then(function(r) { return r.json(); })
          .then(function() {
            btn.classList.remove('adding');
            btn.classList.add('success');
            txt.textContent = '✓ Added!';
            return fetch('/cart.js');
          })
          .then(function(r) { return r.json(); })
          .then(function(cd) {
            document.dispatchEvent(new CustomEvent('cart:change', { detail: { cart: cd } }));
            document.dispatchEvent(new CustomEvent('variant:add', { detail: { cart: cd } }));
            document.dispatchEvent(new CustomEvent('cart:refresh'));
            setTimeout(function() {
              btn.disabled = false;
              btn.classList.remove('success');
              txt.textContent = ot;
            }, 2000);
          })
          .catch(function() {
            txt.textContent = ot;
            btn.disabled = false;
            btn.classList.remove('adding');
          });
      } catch (e) {}
    });
  });

  try {
    document.querySelectorAll('[data-image-info]').forEach(function(info) {
      const pid = info.getAttribute('data-image-info');
      const card = info.closest('.fgc-card');
      if (card) {
        updateImageInfoDisplay(card, pid);
        const activeSwatchColor = card.querySelector('.fgc-swatch.active') ? card.querySelector('.fgc-swatch.active').getAttribute('data-swatch-color') : null;
        if (activeSwatchColor) {
          card.style.setProperty('--active-swatch-color', activeSwatchColor);
        }
      }
    });
  } catch (e) {}

  applyGridApparelSingleRowAlignment();
  window.addEventListener('resize', function(){ applyGridApparelSingleRowAlignment(); });
});
</script>
